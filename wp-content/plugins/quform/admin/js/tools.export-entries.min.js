var quform=function(e,n,t,i){"use strict";var o=e.core,a=o.cache,s={init:function(){s.setupTooltips(),s.setupDatepickers(),a.get("#qfb-export-entries-form-id").change(function(){s.getFieldList()}).change(),a.get("#qfb-export-all-fields").click(function(){n(".qfb-export-field").prop("checked",n(this).is(":checked"))}),a.get("#qfb-export-entries-fields").on("click",".qfb-export-field",function(){a.get("#qfb-export-all-fields").prop("checked",!1)}),a.get("#qfb_format_type").change(function(){a.get("#qfb-export-entries-csv-settings")["csv"==a.get("#qfb_format_type").val()?"qfbSlideShow":"qfbSlideHide"]()}),a.get("#qfb_format_csv_excel_compatibility").change(function(){a.get("#qfb_format_csv_delimiter").add(a.get("#qfb_format_csv_enclosure")).add(a.get("#qfb_format_csv_use_bom")).add(a.get("#qfb_format_csv_line_endings")).closest(o.settingWrap)[a.get("#qfb_format_csv_excel_compatibility").is(":checked")?"qfbSlideHide":"qfbSlideShow"]()}),a.get("#qfb_format_csv_delimiter").change(function(){a.get("#qfb_format_csv_delimiter_custom").closest(o.subSettingWrap)["custom"==a.get("#qfb_format_csv_delimiter").val()?"qfbSlideShow":"qfbSlideHide"]()}),a.get("#qfb_format_csv_enclosure").change(function(){a.get("#qfb_format_csv_enclosure_custom").closest(o.subSettingWrap)["custom"==a.get("#qfb_format_csv_enclosure").val()?"qfbSlideShow":"qfbSlideHide"]()}),n.fn.sortable&&a.get("#qfb-export-entries-fields").sortable({stop:function(){var e=[];a.get("#qfb-export-entries-fields").find(".qfb-export-field").each(function(){e.push(n(this).val())}),n.ajax({type:"POST",url:i.ajaxUrl,data:{action:"quform_save_export_field_list_order",form_id:a.get("#qfb-export-entries-form-id").val(),fields:JSON.stringify(e)}})}})},setupTooltips:function(){n.isFunction(n.fn.qtip)&&n(".qfb-tooltip-icon").qtip({show:{solo:!0},style:{classes:"qtip-dark qtip-dark-quform"},content:{text:function(){return n(this).find(".qfb-tooltip-content").html()}},position:{viewport:!0},hide:{fixed:!0}})},setupDatepickers:function(){var i,o;n.isFunction(n.fn.kendoDatePicker)&&(i=a.get("#qfb_date_from").kendoDatePicker({format:"yyyy-MM-dd",change:function(){var e=i.value(),t=o.value();e?((e=new Date(e)).setDate(e.getDate()),o.min(e)):(t?i.max(new Date(t)):i.max(new Date(2099,11,31)),o.min(new Date(1900,0,1)))}}).data("kendoDatePicker"),o=a.get("#qfb_date_to").kendoDatePicker({format:"yyyy-MM-dd",change:function(){var e=o.value(),t=i.value();e?((e=new Date(e)).setDate(e.getDate()),i.max(e)):t?(o.min(new Date(t)),i.max(new Date(2099,11,31))):(i.max(new Date(2099,11,31)),o.min(new Date(1900,0,1)))}}).data("kendoDatePicker"),a.get("#qfb_date_from").on("click focus",function(){i.open()}),a.get("#qfb_date_to").on("click focus",function(){o.open()}))},getFieldList:function(){a.get("#qfb-export-entries-fields-wrap").hide(),a.get("#qfb-export-entries-fields").empty(),a.get("#qfb-export-all-fields").prop("checked",!1),""!=a.get("#qfb-export-entries-form-id").val()&&(a.get(".qfb-export-entries-loading").show(),n.ajax({type:"POST",url:i.ajaxUrl,data:{action:"quform_get_export_field_list",form_id:a.get("#qfb-export-entries-form-id").val()},dataType:"json"}).done(function(e){switch((e=o.sanitizeResponse(e)).type){case"success":s.onFieldListSuccess(e.data);break;case"error":case"invalid":s.onFieldListFail(e.message)}}).fail(function(){s.onFieldListFail(i.ajaxError)}).always(function(){a.get(".qfb-export-entries-loading").hide()}))},onFieldListSuccess:function(e){for(var t=0;t<e.length;t++)a.get("#qfb-export-entries-fields").append(s.getFieldListItemHtml(e[t]));a.get("#qfb-export-entries-fields-wrap").show()},getFieldListItemHtml:function(e){var t,i=n('<div class="qfb-export-single-field">');return i.append(n("<label>").append(n('<input class="qfb-export-field" type="checkbox" name="qfb_columns[]">').val(e.value),t=n('<span class="qfb-export-field-text">').append(n('<span class="qfb-export-field-label">').text(e.label)))),e.identifier&&t.append(n('<span class="qfb-export-field-identifier">').text("("+e.identifier+")")),i},onFieldListFail:function(e){o.showFixedMessage(t.errorExportingEntries+"<br>"+e,"error")}};return n(s.init),e.tools=e.tools||{},e.tools.exportEntries=s,e}(quform,jQuery,quformToolsExportEntriesL10n,quformCoreL10n);