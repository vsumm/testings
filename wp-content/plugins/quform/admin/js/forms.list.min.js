var quform=function(e,o,t,n){"use strict";var r=e.core,s=r.cache,i=o(document),a=!1,f=!1,d={init:function(){"#add"==window.location.hash&&d.showAddNewFormPopup(),o(".qfb-nav-item-add > a").click(function(e){e.preventDefault(),d.showAddNewFormPopup()}),o(".qfb-form-switcher-add-form-button").click(function(e){e.preventDefault(),d.showAddNewFormPopup()}),s.get("#qfb-add-new-form").on("click",".qfb-popup-close-button",d.hideAddNewFormPopup),s.get("#qfb-forms-add-submit").click(d.addNewForm),s.get("#qfb-forms-add-name").keyup(function(e){13==e.keyCode&&s.get("#qfb-forms-add-submit").click()}),s.get("#the-list").find(".column-shortcode input").on("click",function(){o(this).focus().select()}),s.get("#the-list").find(".delete a").click(function(){return confirm(t.singleConfirmDelete)}),o("#doaction").click(function(){return 0<o('input[name="ids[]"]:checked').length&&("delete"==o("#bulk-action-selector-top").val()?confirm(t.pluralConfirmDelete):void 0)}),o("#doaction2").click(function(){return 0<o('input[name="ids[]"]:checked').length&&("delete"==o("#bulk-action-selector-bottom").val()?confirm(t.pluralConfirmDelete):void 0)}),s.get("#qfb-show-forms-table-settings").click(function(){d.showTableSettings()}),s.get("#qfb-forms-table-settings").find(".qfb-popup-save-button").click(function(){d.saveTableSettings()}),s.get("#qfb-forms-table-settings").find(".qfb-popup-close-button").click(function(){d.hideTableSettings()}),s.get("#qfb-forms-table-settings").find(".qfb-popup-overlay").click(function(){d.hideTableSettings()}),s.get("#qfb_forms_per_page").on("keyup",function(e){e.keyCode&&13==e.keyCode&&d.saveTableSettings()}),i.on("heartbeat-tick",function(e,o){o&&o.nonces_expired&&(o.quformAddFormNonce&&t.addFormNonce!==o.quformAddFormNonce&&(t.addFormNonce=o.quformAddFormNonce),o.quformSaveFormsTableSettingsNonce&&t.saveFormsTableSettingsNonce!==o.quformSaveFormsTableSettingsNonce&&(t.saveFormsTableSettingsNonce=o.quformSaveFormsTableSettingsNonce))})},showAddNewFormPopup:function(){i.on("keydown.quform-close-popup",function(e){27==e.keyCode&&d.hideAddNewFormPopup()}),s.get("body").css("overflow","hidden").addClass("qfb-popup-open"),s.get("#qfb-add-new-form").show(),s.get("#qfb-forms-add-name").focus()},hideAddNewFormPopup:function(){i.off("keydown.quform-close-popup"),s.get("#qfb-add-new-form").hide(),s.get("body").css("overflow","").removeClass("qfb-popup-open")},addNewForm:function(){a||(a=!0,o.ajax({type:"POST",url:n.ajaxUrl,data:{action:"quform_add_form",_ajax_nonce:t.addFormNonce,name:s.get("#qfb-forms-add-name").val()},dataType:"json"}).done(function(e){"success"!=(e=r.sanitizeResponse(e)).type?(s.get("#qfb-add-new-form").find(".qfb-validation-error").remove(),a=!1,"error"!=e.type&&"invalid"!=e.type||d.onAddFormFail(e)):window.location=e.url}).fail(function(){s.get("#qfb-add-new-form").find(".qfb-validation-error").remove(),a=!1,d.onAddFormFail({message:n.ajaxError})}))},onAddFormFail:function(e){var n;r.isNonEmptyString(e.message)&&r.showFixedMessage(t.errorAddingForm+"<br>"+e.message,"error"),e.errors&&o.each(e.errors,function(e,o){var t=s.get("#"+e).closest(r.settingInputWrap);n=n||t,r.addValidationError(t,o)}),n&&r.scrollTo(n,s.get("#qfb-add-new-form-inner"))},showTableSettings:function(){s.get("body").css("overflow","hidden").addClass("qfb-popup-open"),s.get("#qfb-forms-table-settings").show()},hideTableSettings:function(){s.get("body").css("overflow","").removeClass("qfb-popup-open"),s.get("#qfb-forms-table-settings").hide(),s.get("#qfb-forms-table-settings").find(".qfb-submission-error").remove(),s.get("#qfb-forms-table-settings").find(".qfb-validation-error").remove()},saveTableSettings:function(){f||(f=!0,s.get("#qfb-forms-table-settings").find(".qfb-submission-error").remove(),s.get("#qfb-forms-table-settings").find(".qfb-validation-error").remove(),o.ajax({url:n.ajaxUrl,type:"POST",dataType:"json",data:{action:"quform_save_forms_table_settings",_ajax_nonce:t.saveFormsTableSettingsNonce,per_page:s.get("#qfb_forms_per_page").val()}}).done(function(e){var n;e=r.sanitizeResponse(e),f=!1,"success"==e.type?window.location.reload():"error"!=e.type&&"invalid"!=e.type||(n=[],e.message&&n.push(r.addSubmissionError(s.get("#qfb-forms-table-settings").find(".qfb-settings"),e.message)),e.errors&&o.each(e.errors,function(e,o){var t=s.get("#"+e).closest(r.settingInputWrap);r.addValidationError(t,o),n.push(t)}),n.length&&r.scrollTo(n[0],s.get("#qfb-forms-table-settings-inner")))}).fail(function(){r.scrollTo(r.addSubmissionError(s.get("#qfb-forms-table-settings").find(".qfb-settings"),n.ajaxError),s.get("#qfb-forms-table-settings-inner")),f=!1}))}};return o(d.init),e.forms=e.forms||{},e.forms.list=d,e}(quform,jQuery,quformFormsListL10n,quformCoreL10n);